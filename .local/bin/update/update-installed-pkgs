#!/bin/sh

if command -v npm &> /dev/null; then
  echo -e "\033[1m⏳ Updating NPM Packages...\033[0m"
  sudo npm install npm -g
fi

if command -v yarn &> /dev/null; then
  echo -e "\033[1m⏳ Updating Yarn Packages...\033[0m"
  yarn global upgrade
fi

update_linux_pkgs() {
  if command -v $PACKAGE_MANAGER &> /dev/null; then
    echo -e "\033[1m⏳ Updating $PACKAGE_MANAGER Packages...\033[0m"
    $PACKAGE_MANAGER -Syu --noconfirm
  fi

  compile() {
    path="$1"
    echo -e "\033[1m⏳ Compiling $path...\033[0m"
    [ -d "$path" ] && sudo make -C "$path" && sudo make install -C "$path"
  }

  compile "$XDG_SRC_HOME/dwm"
  compile "$XDG_SRC_HOME/dwmblocks"
  compile "$XDG_SRC_HOME/dmenu"
  compile "$XDG_SRC_HOME/st"
  compile "$XDG_SRC_HOME/sxiv-flexipatch"
}

update_macos_pkgs() {
  if command -v brew &> /dev/null; then
    echo -e "\033[1m⏳ Updating Brew Packages...\033[0m"
    brew update
    brew upgrade
    brew cleanup
  fi

  echo -e "\033[1m⏳ Updating Software Packages...\033[0m"
  softwareupdate -i -a

  if command -v gem &> /dev/null; then
    echo -e "\033[1m⏳ Updating Gem Packages...\033[0m"
    sudo gem update --system
    sudo gem update
    sudo gem cleanup
  fi

  # sudo port selfupdate
  # sudo port upgrade outdated
}

if [[ $OSTYPE == 'linux'* ]]; then
  update_linux_pkgs
else
  update_macos_pkgs
fi
