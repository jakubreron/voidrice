#!/usr/bin/env bash

# NOTE: can be mocha, latte, macchiato, frappe
switch_from="${1:-mocha}"
switch_to="${2:-latte}"

declare -a lowercase_paths=(
  "$HOME/.config/alacritty/alacritty.yml"
  "$HOME/.config/rofi/config.rasi"
  "$HOME/.config/lvim/lua/user/builtin/init.lua"
  "$HOME/.config/btop/btop.conf"
  "$HOME/.config/fcitx5/conf/classicui.conf"
  "$HOME/.config/waybar/colorscheme.css"
  "$HOME/.config/tmux/tmux.conf"
  "$HOME/.config/bat/config"
  "$HOME/.config/BetterDiscord/data/stable/custom.css"
  "$HOME/.config/hypr/theme.conf"
)

declare -a uppercase_paths=(
  "$HOME/.config/Kvantum/kvantum.kvconfig" 
)

for path in "${lowercase_paths[@]}"; do
  sed --in-place --follow-symlinks "0,/$switch_from/s//$switch_to/" "$path"
  git-ignore-changes-for-file "$path"
done

for path in "${uppercase_paths[@]}"; do
  sed --in-place --follow-symlinks "s/${switch_from^}/${switch_to^}/" "$path"
  git-ignore-changes-for-file "$path"
done

find /run/user/1000 -maxdepth 1 -regex '/run/user/1000/.*vim.*' | while read -r file
do
  nohup nvr --nostart --remote-send "colorscheme catppuccin-$switch_to<CR>" --servername "$file" &
done

# # NOTE: different approaches

# Dunst
dunst_path="$HOME/.config/dunst/dunstrc.d/99-theme.conf"
ln -fs ~/.config/dunst/themes/catppuccin/src/$switch_to.conf "$dunst_path"
git-ignore-changes-for-file "$dunst_path"

# Starship
starship_path="$HOME/.config/starship.toml"
sed --in-place --follow-symlinks "s/palette = \"catppuccin_$switch_from\"/palette = \"catppuccin_$switch_to\"/" "$starship_path"
git-ignore-changes-for-file "$starship_path"

if pgrep -f "tmux" >/dev/null; then
  tmux source-file ~/.config/tmux/tmux.conf
fi

if pgrep -f "dunst" >/dev/null; then
  killall dunst && sleep 1 && nohup dunst &
fi

# Reload everything after changes changes
if pgrep -f "waybar" >/dev/null; then
  killall waybar && nohup waybar &
fi
