#!/bin/sh

filter() {
	play_icon="üéπ"
	pause_icon="‚è∏"

	name=$(mpc | sed "/^volume:/d;s/\\&/&amp;/g;s/\\[paused\\].*/$pause_icon/g;/\\[playing\\].*/d;/^ERROR/Q" | paste -sd ' ' -)

	trim() {
		cut_characters_count="40"

		if [[ ${#1} -gt $cut_characters_count ]]; then
			echo "$1" | cut "-c1-$cut_characters_count" | sed "s/$/.../g" 
		else
			echo "$1"
		fi
	}

	if [[ $name == *"$pause_icon"* ]]; then
		paused_name=`echo "$name" | sed "s/\(.*\)\($pause_icon\)/\2\1/"`

		trim "$paused_name"
	else
		trim "$play_icon$name"
	fi
}

pidof -x sb-mpdup >/dev/null 2>&1 || sb-mpdup >/dev/null 2>&1 &

case $BLOCK_BUTTON in
	1) mpc status | filter ; setsid -f "$TERMINAL" -e ncmpcpp ;;  # right click, pause/unpause
	2) mpc toggle | filter ;;  # right click, pause/unpause
	3) mpc status | filter ; notify-send "üéµ Music module" "\- Shows mpd song playing.
- ‚è∏ when paused.
- Left click opens ncmpcpp.
- Middle click pauses.
- Scroll changes track.";;  # right click, pause/unpause
	4) mpc prev   | filter ;;  # scroll up, previous
	5) mpc next   | filter ;;  # scroll down, next
	6) mpc status | filter ; "$TERMINAL" -e "$EDITOR" "$0" ;;
	*) mpc status | filter ;;
esac
