#!/usr/bin/env bash

# This script is called on startup to remap keys.
# Decrease key repeat delay to 250ms and increase key repeat rate to 50 per second.
xset r rate 250 50

if xinput --list | grep -q "TrackPoint"; then
    # regex to match only numeric IDs
    id_regex='s/.*id=\([0-9]*\).*/\1/p'

    # find all matching TrackPoint pointers only (there might be multiple pointers, we don't know which one is correct since they have the same name but different id)
    internal_trackpoint_ids=$(xinput --list | grep 'IBM TrackPoint.*pointer' | sed -n "$id_regex")
    external_trackpoint_ids=$(xinput --list | grep 'TrackPoint Keyboard.*pointer' | sed -n "$id_regex")

    adjustAccelSpeed() {
        while read -r internal_trackpoint_ids; do
            xinput --set-prop "$internal_trackpoint_ids" 'libinput Accel Speed' -0.45
            xinput --set-button-map "$internal_trackpoint_ids" 1 2 3
        done <<< "$internal_trackpoint_ids"

        while read -r external_trackpoint_ids; do
            xinput --set-prop "$external_trackpoint_ids" 'libinput Accel Speed' -0.60
            xinput --set-button-map "$external_trackpoint_ids" 1 2 3
        done <<< "$external_trackpoint_ids"
    }

    adjustAccelSpeed
fi
